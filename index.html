<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karakter Ağacı - Treeviz (Yerel Dosyalar)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .instructions {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
        }
        
        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            margin-left: 20px;
            color: #856404;
        }
        
        .instructions code {
            background: #f8f9fa;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        select {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        #tree {
            width: 100%;
            height: 600px;
            background: #fafafa;
            position: relative;
        }
        
        .status {
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        
        /* Node stilleri */
        .node-template {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .node-template:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            border-color: #764ba2;
        }
        
        .node-name {
            font-weight: bold;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .node-title {
            color: #764ba2;
            font-size: 12px;
            font-style: italic;
        }
        
        .node-info {
            color: #6c757d;
            font-size: 11px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌳 Karakter İlişki Ağacı</h1>
            <p>Treeviz Kütüphanesi - Yerel Dosyalar ile Çalışan Versiyon</p>
        </div>
        
        <div class="instructions">
            <h3>⚠️ KURULUM TALİMATLARI</h3>
            <ol>
                <li>Bu dosyayı <code>index.html</code> olarak kaydet</li>
                <li>Aynı klasörde <code>js</code> adında bir klasör oluştur</li>
                <li>Şu dosyaları indir ve <code>js</code> klasörüne koy:
                    <ul>
                        <li><code>d3.v5.min.js</code> → <a href="https://d3js.org/d3.v5.min.js" target="_blank">İndir</a></li>
                        <li><code>treeviz.min.js</code> → <a href="https://unpkg.com/treeviz@3.0.1/dist/treeviz.min.js" target="_blank">İndir</a></li>
                    </ul>
                </li>
                <li>Bu sayfayı yenile (F5)</li>
            </ol>
        </div>
        
        <div id="status" class="status error">
            ⏳ Treeviz yükleniyor... Eğer bu mesaj kalırsa, yukarıdaki talimatları takip et!
        </div>
        
        <div class="controls">
            <select id="dataSet">
                <option value="fantasy">Fantastik Krallık</option>
                <option value="company">Şirket Yapısı</option>
                <option value="family">Aile Ağacı</option>
            </select>
            
            <button onclick="changeDataSet()">Veri Setini Değiştir</button>
            <button onclick="addNewCharacter()">Yeni Karakter Ekle</button>
            <button onclick="resetTree()">Ağacı Sıfırla</button>
        </div>
        
        <div id="tree"></div>
    </div>

    <!-- YEREL DOSYALARI YÜKLEYELİM -->
    <!-- Önce D3.js -->
    <script src="js/d3.v5.min.js"></script>
    <!-- Sonra Treeviz -->
    <script src="js/treeviz.js"></script>
    
    <!-- YEDEK: Eğer yerel dosyalar yoksa CDN'den yükle -->
    <script>
        // Treeviz yüklendi mi kontrol et
        if (typeof d3 === 'undefined') {
            console.warn('D3.js yerel dosyası bulunamadı, CDN\'den yükleniyor...');
            var d3Script = document.createElement('script');
            d3Script.src = 'https://d3js.org/d3.v5.min.js';
            document.head.appendChild(d3Script);
        }
        
        // Biraz bekle ve Treeviz'i kontrol et
        setTimeout(function() {
            if (typeof Treeviz === 'undefined') {
                console.warn('Treeviz yerel dosyası bulunamadı, CDN\'den yükleniyor...');
                var treevizScript = document.createElement('script');
                treevizScript.src = 'https://unpkg.com/treeviz@3.0.1/dist/treeviz.min.js';
                document.head.appendChild(treevizScript);
                
                // CDN yüklendiğinde ağacı başlat
                treevizScript.onload = function() {
                    initializeApp();
                };
            } else {
                // Yerel dosya yüklendi
                initializeApp();
            }
        }, 500);
    </script>
    
    <script>
        // Veri setleri
        const dataSets = {
            fantasy: [
                { id: 1, name: "Kral Aldric", title: "Demir Taht Hükümdarı", info: "Güç: 100", parent: null },
                { id: 2, name: "Prenses Lyra", title: "Veliaht Prenses", info: "Güç: 85", parent: 1 },
                { id: 3, name: "Prens Darian", title: "Gölge Prens", info: "Güç: 90", parent: 1 },
                { id: 4, name: "Büyücü Merlin", title: "Baş Danışman", info: "Güç: 95", parent: 1 },
                { id: 5, name: "Elara", title: "Genç Büyücü", info: "Güç: 60", parent: 4 },
                { id: 6, name: "Sir Garrett", title: "Muhafız Komutanı", info: "Güç: 75", parent: 2 },
                { id: 7, name: "Lady Morgan", title: "Gizli Danışman", info: "Güç: 88", parent: 3 }
            ],
            company: [
                { id: 1, name: "Ahmet Yılmaz", title: "CEO", info: "10 yıl deneyim", parent: null },
                { id: 2, name: "Ayşe Kaya", title: "CTO", info: "Teknoloji lideri", parent: 1 },
                { id: 3, name: "Mehmet Öz", title: "CFO", info: "Finans uzmanı", parent: 1 },
                { id: 4, name: "Zeynep Ak", title: "Geliştirici", info: "Full-stack", parent: 2 },
                { id: 5, name: "Can Yurt", title: "Tasarımcı", info: "UI/UX", parent: 2 },
                { id: 6, name: "Elif Gün", title: "Muhasebe", info: "5 yıl deneyim", parent: 3 }
            ],
            family: [
                { id: 1, name: "Dede Mustafa", title: "Aile Büyüğü", info: "85 yaşında", parent: null },
                { id: 2, name: "Baba Ali", title: "Baba", info: "55 yaşında", parent: 1 },
                { id: 3, name: "Amca Veli", title: "Amca", info: "52 yaşında", parent: 1 },
                { id: 4, name: "Ben", title: "Torun", info: "25 yaşında", parent: 2 },
                { id: 5, name: "Kardeş Ayşe", title: "Torun", info: "22 yaşında", parent: 2 },
                { id: 6, name: "Kuzen Mehmet", title: "Torun", info: "24 yaşında", parent: 3 }
            ]
        };
        
        let currentDataSet = 'fantasy';
        let myTree = null;
        let nextId = 100;
        
        // Uygulamayı başlat
        function initializeApp() {
            if (typeof Treeviz === 'undefined') {
                document.getElementById('status').innerHTML = 
                    '❌ HATA: Treeviz yüklenemedi! Lütfen dosyaları indirip js klasörüne koyun.';
                return;
            }
            
            document.getElementById('status').className = 'status success';
            document.getElementById('status').innerHTML = 
                '✅ Treeviz başarıyla yüklendi! Ağaç hazır.';
            
            createTree();
        }
        
        // Ağacı oluştur
        function createTree() {
            document.getElementById('tree').innerHTML = '';
            
            myTree = Treeviz.create({
                htmlId: "tree",
                idKey: "id",
                hasFlatData: true,
                relationnalField: "parent",
                nodeWidth: 160,
                nodeHeight: 80,
                mainAxisNodeSpacing: "auto",
                secondaryAxisNodeSpacing: 1.5,
                isHorizontal: true,
                hasZoom: true,
                hasPan: true,
                duration: 750,
                linkShape: "quadraticBeziers",
                linkColor: () => "#9b59b6",
                linkWidth: () => 3,
                renderNode: function(node) {
                    return `
                        <div class="node-template">
                            <div class="node-name">${node.data.name}</div>
                            <div class="node-title">${node.data.title}</div>
                            <div class="node-info">${node.data.info}</div>
                        </div>
                    `;
                },
                onNodeClick: function(node) {
                    alert(`
Karakter Bilgileri:
-------------------
İsim: ${node.data.name}
Ünvan: ${node.data.title}
Bilgi: ${node.data.info}
ID: ${node.data.id}
                    `);
                }
            });
            
            myTree.refresh(dataSets[currentDataSet]);
        }
        
        // Veri setini değiştir
        function changeDataSet() {
            currentDataSet = document.getElementById('dataSet').value;
            if (myTree) {
                myTree.refresh(dataSets[currentDataSet]);
            }
        }
        
        // Yeni karakter ekle
        function addNewCharacter() {
            if (!myTree) return;
            
            const name = prompt("Karakter adı:");
            if (!name) return;
            
            const title = prompt("Karakter ünvanı:");
            const info = prompt("Ek bilgi:");
            
            const currentData = dataSets[currentDataSet];
            const parentOptions = currentData.map(d => `${d.id}: ${d.name}`).join('\n');
            const parentId = prompt(`Bağlı olacağı karakter ID'si:\n${parentOptions}`);
            
            const newCharacter = {
                id: nextId++,
                name: name,
                title: title || "Yeni Karakter",
                info: info || "Bilgi yok",
                parent: parseInt(parentId) || 1
            };
            
            currentData.push(newCharacter);
            myTree.refresh(currentData);
        }
        
        // Ağacı sıfırla
        function resetTree() {
            if (myTree) {
                // Orijinal veriyi geri yükle
                dataSets[currentDataSet] = dataSets[currentDataSet].filter(d => d.id < 100);
                myTree.refresh(dataSets[currentDataSet]);
            }
        }
    </script>
</body>
</html>
